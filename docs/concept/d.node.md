# Node

## Koa 的中间件思想

> koa 最大的特色，就是中间件的设计

koa app 是一个包含一组中间件函数的对象，它是按照类似堆栈的方式组织和执行的

中间件可以简单看作是一个函数对象，被用在两个执行步骤之间，达到某种中间功能

中间件默认接受两个参数：Context对象，next函数，只要调用 `next()` 就表示将执行权**暂时**传递给下一个middleware

中间件更多的使用方式是**级连**，即中间件栈，当在下游没有更多的中间件执行后，堆栈将展开并且每个中间件恢复执行其上游行为，类似**先进后出**的处理机制

1. 最外层中间件首先执行
2. 调用 next 函数，将执行权暂时交给下一个中间件
3. ...
4. 最内层的中间件开始执行，其下游没有更多的中间件
5. 执行结束后，将执行权交回给上一层中间件
6. ...
7. 最外层的中间件回收到执行权之后，执行 next 之后的方法