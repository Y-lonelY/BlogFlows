# æ·±å…¥æµ…å‡º Webpack

> Smaller, Faster,  Modules

è¿™æ˜¯ä¸€ç¯‡è¯»ä¹¦ç¬”è®°, è®°å½•æˆ‘åœ¨é˜…è¯»**æ·±å…¥æµ…å‡º Webpack**å’Œ**Webpack å®˜æ–¹æ–‡æ¡£**è¿‡ç¨‹ä¸­çš„æ‰€å­¦æ‰€æ€ğŸ”¥

# æ¨¡å—åŒ–

> Module is the future!

å¯¹äºç°åœ¨çš„ Web åº”ç”¨æ¥è¯´, æ¨¡å—åŒ–æ˜¯ä¸€ä¸ªç»•ä¸å¼€çš„è¯é¢˜. **æ¨¡å—åŒ–æ˜¯æŒ‡å°†ä¸€ä¸ªå¤æ‚çš„ç³»ç»Ÿåˆ†è§£ä¸ºå¤šä¸ªæ¨¡å—ä»¥æ–¹ä¾¿ç¼–ç , ç®€å•æ¥è¯´å°±æ˜¯: è¾“å…¥/è¾“å‡ºä»£ç å—**

åœ¨ jQuery çš„é‚£ä¸ªæ—¶ä»£, å¤§å¤šæ•°çš„è„šæœ¬éƒ½æ˜¯å°†å…¶ API æŒ‚è½½åˆ°å…¨å±€å‘½åç©ºé—´ï¼ˆæ¯”å¦‚ `window.$`ï¼‰ä¸‹, ä»¥åœ¨ä¸åŒæ–‡ä»¶å†…è¿›è¡Œå¼•ç”¨.

ç°åœ¨å›è¿‡å¤´æ¥æ€è€ƒä¸€ä¸‹, è¿™æ ·çš„åšæ³•ä¼šå¸¦æ¥ä¸€äº›é—®é¢˜

- æ— æ³•åˆç†åœ°ç®¡ç†é¡¹ç›®çš„ä¾èµ–å’Œç‰ˆæœ¬ï¼ˆå‘½åç©ºé—´å†²çªçš„é—®é¢˜ï¼‰
- æ— æ³•æ–¹ä¾¿åœ°æ§åˆ¶ä¾èµ–çš„åŠ è½½é¡ºåº

å½“é¡¹ç›®çš„ä¾èµ–å¢å¤šæˆ–è€…å‰ç«¯é¡¹ç›®å˜å¤§æ—¶, è¿™ç§æ–¹å¼è¶Šæ¥è¶Šéš¾ä»¥ç»´æŠ¤, äºæ˜¯æœ‰äº†æ¨¡å—çš„ä¸€äº›è§£å†³æ–¹æ¡ˆ

è¿™é‡Œä»…é’ˆå¯¹ JavaScript å†…çš„æ¨¡å—åŒ–æ–¹æ¡ˆè¿›è¡Œä»‹ç», è¿˜æœ‰å…³äºæ ·å¼çš„æ¨¡å—åŒ–æ–¹æ¡ˆ, æ¯”å¦‚ `less` ç­‰, è¿™é‡Œå°±ä¸å†è¿›èµ˜è¿°, ç›®çš„æ˜¯ä¸ºäº†è®©ä½ èƒ½å¤Ÿæ„ŸçŸ¥åˆ°: 

**æˆ‘ä»¬å°è£…äº†å¾ˆå¤šè½®å­, æ¥ä½¿æˆ‘ä»¬æ›´é«˜æ•ˆçš„ç¼–ç , ä½†æ˜¯å¾€å¾€éœ€è¦ç¼–è¯‘åçš„ä»£ç æ‰èƒ½æ¥è®©æœºå™¨æ‰§è¡Œ**



## CommonJS

éšç€ NodeJS çš„æµè¡Œ, è¿™ç§æ¨¡å—åŒ–æ–¹æ¡ˆè¢«å‘æ‰¬å…‰å¤§, å…¶æ ¸å¿ƒæ€æƒ³æ˜¯**é€šè¿‡ `require` æ–¹æ³•æ¥åŒæ­¥åŠ è½½(è¾“å…¥)ä¾èµ–, é€šè¿‡ `module.exports` æ¥è¾“å‡ºä»£ç å—**

CommonJS é€šå¸¸è¢«ç”¨æ¥åœ¨éæµè§ˆå™¨ç«¯ç®¡ç†ä¾èµ–ï¼Œè®¾è®¡ç›®çš„æ˜¯é¿å…æ¨¡å—å®šä¹‰å…¨å±€å¯¹è±¡.

**åœ¨ CommonJS å†…ï¼Œä¸€ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å—**

å¯ä»¥ç›´æ¥åœ¨ NodeJS ç¯å¢ƒä¸‹è¿è¡Œ, ä½†æ˜¯æ— æ³•ç›´æ¥åœ¨æµè§ˆå™¨ç¯å¢ƒä¸‹è¿è¡Œ, éœ€è¦è½¬æ¢æˆæ ‡å‡† ES5 



## AMD

**AMD(Asynchronous Module Definition)** é¡¾åæ€ä¹‰, å®ƒé‡‡ç”¨å¼‚æ­¥çš„æ–¹å¼æ¥åŠ è½½ä¾èµ–çš„æ¨¡å—, jQuery æ—¶ä»£é‡Œ, [requirejs](https://requirejs.org/) å°±æ˜¯å…¶å…¸å‹ä»£è¡¨.

çœ‹ä¸€ä¸ªä½¿ç”¨ `requirejs` çš„ä¾‹å­ï¼š

```javascript
// defined a module
define('jquery', function(jq) {
  return jq.noConflict(true)
})

// require a moduel
require(['jquery'], function($) {
  console.log($)
})
```

å…¶ä¼˜åŠ¿åœ¨äº

- å¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨ç¯å¢ƒæˆ–è€… NodeJS ç¯å¢ƒä¸‹è¿è¡Œ
- å¯ä»¥å¼‚æ­¥åŠ è½½ä¾èµ–
- å¯ä»¥å¹¶è¡ŒåŠ è½½å¤šä¸ªä¾èµ–

ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾, å°±æ˜¯éœ€è¦å¼•å…¥ç¬¬ä¸‰æ–¹ä¾èµ–æ¥å®ç°



## ES6 module

è¿™åº”è¯¥æ˜¯å¤§å®¶éå¸¸ç†Ÿæ‚‰çš„, ç°ä»£æ¡†æ¶éƒ½æ˜¯æ”¯æŒçš„æ¨¡å—åŒ–æ–¹æ¡ˆ, ä½†æ˜¯å®ƒä¹Ÿæ— æ³•åœ¨ NodeJS å’Œæµè§ˆå™¨ç¯å¢ƒä¸‹ç›´æ¥è¿è¡Œ

- ä¸€ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œä¸æ”¯æŒæŒ‰éœ€åŠ è½½
- ES6 æ¨¡å—æ˜¯é™æ€çš„ï¼Œå³å¯¼å…¥åæ— æ³•è¿›è¡Œæ›´æ”¹
- ES6 æ˜¯æŒ‡é’ˆç»‘å®šï¼Œåœ¨ç¼–è¯‘æ—¶è¾“å‡ºï¼Œä¸åŒäº CommonJS å€¼ç»‘å®šï¼Œæ¨¡å—å†…åšå‡ºäº†ä¿®æ”¹ï¼Œä¼šåæ˜ åˆ°æ‰€æœ‰ä½¿ç”¨è¯¥æ¨¡å—çš„ä»£ç ä¸­
- ES6æ¨¡å—é‡‡ç”¨çš„æ˜¯å•ä¾‹æ¨¡å¼ï¼Œæ¯æ¬¡å¯¹åŒä¸€ä¸ªæ¨¡å—çš„å¯¼å…¥å…¶å®éƒ½æŒ‡å‘åŒä¸€ä¸ªå®ä¾‹



## æ„å»º

å‰ç«¯æ„å»ºåˆ°åº•æ˜¯æ€ä¹ˆä¸€å›äº‹å‘¢ï¼Ÿæˆ‘ä»¬ä¸å¦¨ä» [webpack](https://www.webpackjs.com/) çš„å®˜ç½‘ä¸Šä¸€çª¥ç©¶ç«Ÿ

![webpack](../assets/webpack.png)

**å‰ç«¯æ„å»ºè¦åšçš„å°±æ˜¯å°†å„ä¸ªæ¥æºçš„èµ„æºï¼ˆè„šæœ¬æ–‡ä»¶ä¹Ÿæ˜¯èµ„æºï¼‰è½¬æ¢æˆå¯æ‰§è¡Œçš„ JavaScript, HTML, CSS ä»£ç **

- ä»£ç è½¬æ¢, æ¯”å¦‚ TypeScript -> JavaScript, less/sass/scss -> css
- æ–‡ä»¶ä¼˜åŒ–, å³æ–‡ä»¶å‹ç¼©
- ä»£ç åˆ†å‰²
- æ¨¡å—åˆå¹¶, å°†å¤ç”¨æ¨¡å—åˆå¹¶åˆ°åŒä¸€ä¸ªæ–‡ä»¶å†…
- è‡ªåŠ¨åˆ·æ–°, ç›‘å¬æ–‡ä»¶å˜åŒ–, é‡æ–°æ„å»ºå¹¶åˆ·æ–°æµè§ˆå™¨é¡µé¢
- è‡ªåŠ¨å‘å¸ƒ

# Webpack Config

è¿™é‡Œæˆ‘ä¼šå¯¹ä¸€äº›é‡è¦çš„é…ç½®å±æ€§è¿›è¡Œä»‹ç», å¦‚æœ‰å¿…è¦ä¼šé’ˆå¯¹æ€§çš„è¿›è¡Œæ·±å…¥åˆ†æ

å…ˆæ¥çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­

```javascript
const path = require('path')

module.exports = {
  entry: './src/index.js',
  // to define the output file path and name
  // with NodeJS core module path
  output: {
    path: path.resolve(__dirname, 'dist'),
    filename: 'bundle.js'
  },
  // loaders to support file compiler
  // compiling form right to left 
  module: {
    rules: [
      {
        test: /\.css$/,
        // like get request to transfer params
        use: ['style-loader', 'css-loader']
      }
    ]
  }
}
```



æˆ‘ä»¬å…ˆå¯¹ Webpack çš„æ ¸å¿ƒæ¦‚å¿µè¿›è¡Œäº†è§£

- **Entry**: Webpack æ‰§è¡Œæ„å»ºä»»åŠ¡çš„å…¥å£
- **Module**: æ¨¡å—æ˜¯ Webpack å†…çš„æ ¸å¿ƒæ¦‚å¿µ, ä¸€ä¸ªæ–‡ä»¶å¯¹åº”ä¸€ä¸ªæ¨¡å—, Webpack ä¼šæ ¹æ®å…¥å£é€’å½’æŸ¥æ‰¾å‡ºæ‰€æœ‰æ¨¡å—çš„é€’å½’å…³ç³»
- **Chunk**: ä¸€ä¸ªä»£ç å—ç”±å¤šä¸ªæ¨¡å—æ„æˆ, ç”¨äºä»£ç åˆ†å‰².
- **Loader**: ä»£ç è½¬æ¢å™¨, æŸ¥çœ‹[loaders](./loaders.md)
- **Plugin**: æ‰©å±•æ’ä»¶, äº†è§£ [plugin](./plugin)
- **Output**: è¾“å‡ºå†…å®¹



## Entry

`entry` æ”¯æŒé…ç½®**å¤šä¸»å…¥å£**

> This is useful when you would like to inject multiple dependent files together and graph their dependencies into one chunk.

é™¤äº†æ”¯æŒ string å¤–, è¿˜å¯ä»¥é€šè¿‡åˆ—è¡¨æˆ–è€…å¯¹è±¡çš„å½¢å¼ä¸ºå…¶é…ç½®å…¥å£

- Entry ç±»å‹ä¸º `string` æˆ–è€… `array`, åˆ™åªä¼šç”Ÿæˆä¸€ä¸ª chunk, ä¸”åå­—ä¸º `main`
- Entry ç±»å‹ä¸º `object`, åˆ™ä¼šç”Ÿæˆå¤šä¸ª chunk, æ¯ä¸ª chunk åå­—ä¸ºå…¶**é”®å€¼**

```javascript
module.exports = {
  // string -> main.js
  entry: './src/index.js',
	// array -> main.js
  entry: [
    './src/app1/index.js',
    './src/app2/index.js'
  ],
  // object -> app1.js, app2.js
  entry: {
    app1: './src/app1/index.js',
    app2: './src/app2/index.js'
  }
}
```





## Output

**output** ç”¨æ¥å‘Šè¯‰ Webpack å¦‚ä½•åœ¨ç£ç›˜ä¸Šå†™å…¥æœ€ç»ˆè¾“å‡ºçš„æ–‡ä»¶, é…ç½®ç±»å‹ä¸º object

```javascript
output: {
  path: path.resolve(__dirname, 'dist'),
  // [name] will add filename
  filename: '[name].bundle.js',
  publicPath: 'https://7k7k.life/assets/'
},
```



- `path` è¾“å‡ºæ–‡ä»¶å­˜æ”¾çš„ç›®å½•, æ˜¯ä¸€ä¸ª**ç»å¯¹è·¯å¾„**, é€šå¸¸é€šè¿‡ `path.resolve(__dirname, 'path')` æ¥å®šä¹‰
- `filename` è¾“å‡ºæ–‡ä»¶çš„åå­—, æ”¯æŒæ¨¡ç‰ˆå­—ç¬¦ä¸², å½“ entry é…ç½®ä¸ºå¤šå…¥å£æ—¶, éœ€è¦ä½¿ç”¨æ¨¡ç‰ˆè¯­æ³•æ¥ç¡®ä¿æ¯ä¸ªè¾“å‡ºæ–‡ä»¶æœ‰**å”¯ä¸€çš„åå­—**

| å˜é‡å                                            | å«ä¹‰                                 |
| :------------------------------------------------ | ------------------------------------ |
| id                                                | Chunk çš„å”¯ä¸€æ ‡è¯†ï¼Œä»0å¼€å§‹            |
| name                                              | Chunk çš„åç§°                         |
| hash, æ¯”å¦‚ `[hash:8]` è¡¨ç¤ºå–8ä½ hash å€¼           | Chunk çš„å”¯ä¸€æ ‡è¯†çš„ Hash å€¼           |
| chunkhash                                         | Chunk å†…å®¹çš„ Hash å€¼, ç”±ä¸€ç»„æ¨¡å—ç»„æˆ |
| contenthash, éœ€è¦ `ExtractTextWebpackPlugin` æ’ä»¶ | ä»£ç å†…å®¹æœ¬èº«ç»„æˆçš„ Chunk             |

- `publicPath` ç”¨æ¥é…ç½®èµ„æºæ–‡ä»¶çš„è·¯å¾„, æ¯”å¦‚ä½ æœ‰ä¸€ä¸ªå›¾ç‰‡æœåŠ¡å™¨, åœ°å€ä¸º `https:www.images.com/assets/`, æ­¤æ—¶å¯ä»¥é…ç½® `output.publicPath:https:www.images.com/assets/ `, å®ƒä¼šå‘Šè¯‰ Webpack, åœ¨ç¼–è¯‘çš„æ—¶å€™ç¢°åˆ°å¼•ç”¨è¯¥åœ°å€çš„èµ„æºæ–‡ä»¶, ä½ ä¸ç”¨è¿›è¡Œæ„ŸçŸ¥, å¹¶ä¸”è¿™ä¸ªå±æ€§æ”¯æŒåœ¨å…¥å£æ–‡ä»¶é€šè¿‡ `__webpack_public_path__ = PublicPath` æ¥è¿›è¡ŒåŠ¨æ€é…ç½®



## Chunk

ä¸€ä¸ª **chunk** ç”±å¤šä¸ª module ç»„æˆ, ç”¨äºä»£ç åˆ†å‰²å’Œåˆå¹¶

**ä¸€ä¸ª entry å’Œå…¶æ‰€æœ‰ä¾èµ–çš„ Modules ç»„æˆä¸€ä¸ª chunk**

ä¸¾ä¸ªä¾‹å­: åœ¨ webpack 4 ä¹‹å‰, é€šå¸¸å°†ä¸€äº›ä¸ä¼šå†æ”¹å˜çš„è„šæœ¬(æ¯”å¦‚ `JQuery, Bootstrap` ç­‰)æ”¾åˆ°ä¸€ä¸ª chunk å†…(é€šå¸¸æ˜¯ `vendor.js`), è¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†è®©æµè§ˆå™¨ç¼“å­˜è¿™äº›è„šæœ¬, ä»è€Œå‡å°‘åŠ è½½æ—¶é—´

**webpack 4 ä¹‹åé€šè¿‡ optimization.splitChunks å±æ€§æ¥é…ç½®, è¿›è¡Œä»£ç åˆ†å‰²**



## Loaders

Webpack ä»…ä»…èƒ½å¤Ÿç†è§£ `JavaScript` å’Œ `json` ç±»å‹æ–‡ä»¶, è¿™æ˜¾ç„¶ä¸è¶³ä»¥è¦†ç›–æˆ‘ä»¬çš„æ—¥å¸¸éœ€æ±‚

Webpack çš„ Loader æœºåˆ¶èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬æ‰“åŒ… webpack æœ¬èº«ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹, æ¯”å¦‚æ ·å¼æ–‡ä»¶

- å°†å…¶è½¬æ¢ä¸ºèƒ½å¤Ÿè¢«åº”ç”¨â€œæ¶ˆè´¹â€çš„æœ‰æ„ä¹‰çš„æ¨¡å—
- å°†å…¶åŠ å…¥åˆ°ä¾èµ–è§†å›¾

**loaders** æœ‰ä¸¤ä¸ªé…ç½®å±æ€§

- `test` ç”¨æ¥åŒ¹é…éœ€è¦è½¬æ¢çš„æ–‡ä»¶ç±»å‹
- `use` ç”¨æ¥åˆ†é…å¯¹åº”çš„ loader å¯¹è¯¥æ–‡ä»¶è¿›è¡Œå¤„ç†, loaders **ä»å³è‡³å·¦è¿›è¡Œè§£æ**



## Plugins

Webpack çš„ **Plugins** æœºåˆ¶èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬æ‰§è¡Œæ›´â€œç»†è‡´â€çš„ä»»åŠ¡, å®ƒå¯ä»¥çœ‹ä½œæ˜¯ **Loaders** èƒ½åŠ›çš„æ‰©å±•, æ¯”å¦‚:

- æ‰“åŒ…ä¼˜åŒ–
- èµ„æºç®¡ç†
- ç¯å¢ƒå˜é‡æ³¨å…¥



