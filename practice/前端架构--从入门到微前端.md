<!-- MarkdownTOC -->

- [前端架构--从入门到微前端](#%E5%89%8D%E7%AB%AF%E6%9E%B6%E6%9E%84--%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%BE%AE%E5%89%8D%E7%AB%AF)
	- [miraculous sentences](#miraculous-sentences)
	- [What's Software Architecture?](#whats-software-architecture)
		- [Architecture Mode](#architecture-mode)
		- [Frontend Architecture](#frontend-architecture)
	- [What would you do](#what-would-you-do)
	- [Work Flow](#work-flow)
		- [规范代码](#%E8%A7%84%E8%8C%83%E4%BB%A3%E7%A0%81)
		- [规范项目文档](#%E8%A7%84%E8%8C%83%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3)
		- [代码质量](#%E4%BB%A3%E7%A0%81%E8%B4%A8%E9%87%8F)
	- [Build Flow](#build-flow)

<!-- /MarkdownTOC -->


# 前端架构--从入门到微前端


## miraculous sentences

没有一种架构能满足未来的需求。

## What's Software Architecture?

> 架构是指体现在它的组件中的一个系统的基本组织、组织之间的关系、组织和环境的关系及指导其设计和发展的原则

以 lego 为例：
- 一个 lego 内包含实现最终完成体的所有物料
- 多个物料可以组合成一个模块
- 这个时候，说明书扮演着类似架构的角色，它说明了**物料**、**物料组织方式**、**预期效果**、**注意事项**
- 软件架构相对于说明书，它需要考虑当前环境的因素，需要一定的前瞻性，同时需要规定新模块的接入规范；同时它也有一定的局限性，它无法准确预计架构不再适用的标准和准确时间点

了解架构的基本原则之后，我们需要思考：架构从何而来？或者说，架构用来解决什么问题？

很重要的一点是，**脱离技术的角度去看待问题**，之前杨老师也经常跟我强调这点，随着开发经验的丰富，对这句话有了一定的理解

- 架构的落地是一个多方博弈的产物，因此，需要了解各方的利益和需求
- 寻找架构的特点（可以吹的点，业界有没有？为什么我的比他的好？）
- 关注点和优先级
- 跨功能需求
- 技术风险点

关注点和优先级，优先级往往不是绝对的，会根据具体项目来动态平衡

|key|value|
|:-|:-|
|性能|渲染，QPS|
|安全|数据安全，应对攻击的能力|
|平台化|承载其他系统的能力|
|代码维护|code review，快速上手，快速迭代|
|用户体验|简单，优雅|

**注意**: 作为一个程序员，要坚持以数据来说服人--提供不同浏览器、系统的占比，或者提供支持向下兼容的成本估算--真实的估算

### Architecture Mode

架构风格是架构模式的表现形式，代码架构是架构风格的一个具体表现

- 分层风格，将系统按照水平切分的方式分成多个层，一个系统由多层组成，一层由多个模块组成，例如OSI七层模型和TCP/IP五层模型
- MVC，经典模型，由 View 和 Controller 共同完成用户界面的功能，设计一套变更机制，保证用户界面和模型的一致性
- 发布-订阅，基于事件，完成发布者和订阅者的交互
- 管理和过滤器，还比较陌生，这是一种适用于处理数据流的架构模式，它封装每个步骤到一个过滤器组件内，数据通过相邻过滤器之间的管道传输

一个架构，其产出或者说基本资源需要（部分内容对团队建设也有帮助）：

- 架构图
- 迭代计划
- 技术栈及选型
- 示例代码
- 测试策略
- 部署方式及持续集成策略
- 团队协作，GIT 提交策略

这里深入一点，架构设计最理想的是20%的计划式设计和80%的演化式设计，在计划式设计阶段，我们需要：

- 基础建设，确保架构能够处理的最大风险
- 前后端分离架构的基本规范，JSON 数据格式，RESTful API 规范；后台语言，数据库等；前端组织、UI框架等

### Frontend Architecture

前端架构的发展史，几个关键点

- 2005 年之前，主要还是后端渲染出 HTML（比如 JSP）,通过 JavaScript 做一些简单的动效
- 2005 年，**Google** 在其大多应用中使用异步通信技术，开启了 WEB 前端的新时代，这意味着，UI 和 Model 层的解耦，在这之后的很长一段时间内，JQuery 大发异彩，也启发了很多开发思想，比如动态渲染模版
- NodeJs 的出现再次为前端注入了新的活力，前端开始工程化，比如构建工具，包管理，模版管理等等，单页面应用的流行，诞生了两个优秀开源框架 React、Vue，同时也丰富了前端生态

随着前端项目的复杂，组件化和 MV\* 的方式已经渐渐发力，于是，微前端提供了一种解决问题新的思路，它被设计用来解决：

- 跨框架，在一个页面上，可以允许运行多个前端框架
- 应用拆分，将一个应用拆解为多个微小的应用，类似微服务
- 遗留系统迁移，兼容旧的前端框架

下面的主要内容，也是围绕这些问题来展开和思考🤔

就层级来说：
架构设计可以分为4⃣️个层级，每个层级有自己的关注点和规则，由上而下：

- 系统级，**前后端分离架构**、微前端架构，规定了应用在系统内的关系、前后端数据交换、系统集成等
- 应用级，规定应用外部的整体架构，组件共享，应用通信等
- 模块级，应用内部的模块架构，比如路由、状态管理等模块化
- 代码级，代码规范、原则、质量

**自上而下设计，自下而上完善**

前后端分离，不仅仅是指代码分离，它是一种技术决策，比如用户鉴权、API 接口管理和设计、API 文档管理、BBF、Mock Server


## What would you do

结合更实际的场景，如果由你来负责一个适合微前端的场景项目，你会怎么做？

不如先从宏观概念来解析这个问题

- 平衡业务进度和技术实现
	- 技术实现：方案设计、实施、上线、维护、开源或者沉淀
- 解决核心、复杂的问题
- 关注团队构建和成长

可以看出，技术架构其中在的一环，不起眼却很重要，可以看作一个项目的设计图（我理解为优秀项目的入口），
思考一下在工作中，当小组尝试重新构建一个项目时，我们是怎么做的？

一、技术准备期：技术强相关，耗时久

1. 前期进行大量有效调研和技术积累，明白系统的目的和需求，进行**架构设计**，这个过程通常输出一份架构图，用于展示和研究
2. 概念验证，这里已经涉及到项目分工和合作，这个阶段更多的是通过编写简单的代码来验证架构的可行性，进行快速迭代、调整或者淘汰
3. 迭代0，进入到这个阶段意味着：项目配套的技术准备工作已经就绪（我理解是可以直接开始编写业务代码），项目成员可以进行正常的开发工作，这个阶段，我们要做的：
	- 创建应用脚手架
	- 创建代码库
	- 搭建持续集成/交付
	- 权限控制
	- 内部培训

二、业务追捕期：这里探讨一下业务和技术的关系

> 先进的技术和架构是否一定会带来业务价值？不一定！

技术和架构价值最直观的体现？**业务价值的提升**

业务价值最直观的体现？**赚钱**

业务和技术两者是相辅相成，互相成就：没有业务做佐证的价值一文不值，没有优秀技术和架构支撑，业务也很难有好的表现

会看到身边毕业一两年的同事，执着于技术，作为一个技术从业人员来说未可厚非，但是以此作为抨击的点，就大可不必了，信息差会造成格局和视野的区别，所以做好自己就行

这个时期我们要做的：
- 测试，根据实际情况进行编写用例，尽量减少新需求和旧bug，开发和测试之间的矛盾
- 上线前准备，第一次项目上线

在这个时期，我们极大可能会因为能力高低和专注领域的不同而产生差值，这就是提升团队能力的机会：
- 技术分享，纯技术类或者项目相关技术类，分享的主讲人会从中受益
- 工作坊，是一种以练习为主，理论为辅的掌握新技术的方式，类似 Bootcamp
- 面对团队新人，采用**领航员-驾驶员**的模式来进行结对编程
- 对内和对外输出

ok，经过前两个时期，我们的项目已经可以稳定线上运行了，但是可以预见的是，不可能在各国阶段都做到尽善尽美。
如果你是一个“匠人”的话，欢迎进入第三个阶段

三、成长优化期

在开发过程中，常常会因为 deadline 而忽视测试和代码质量，或多或少会采取一些妥协措施，这种称之为**技术债**

1. 代码质量，比如接口、函数的大量复用，新旧模式的耦合，不规范的代码提交
2. 测试覆盖率，基本上国内互联网都没有专业的测试
3. 依赖问题，通过是依赖组件的更新，判断时候在项目内应用该更新内容

个人认为，偿还技术债往往带来更深的思考和更高的收益。除此之外，在这个时期要做的就是想方设法进行自我提升，可以是自动化测试，提升开发体验，代码迭代或者架构优化等


## Work Flow

> 通过一系列的流控制来保持质量-速度-需求的平衡

### 规范代码

代码结构往往能够反映顶层应用的设计，因此一个规范易读的代码还是蛮重要的（作为一个技术从业者，不要相信什么垃圾代码可以提升你的不可替代性，bullshit🐶）

规范相关的积累参看[开发规范](http://122.51.215.237:7771/normalize/)

除此之外，可以通过 ESLint, CSSLint 来进一步提高代码的质量，这样做的目的是团队能够输出风格统一的代码以及方便 review，**一般来说，Lint 工具已经可以解决大部分的代码规范问题**

### 规范项目文档

文档对于一个项目而言，是重中之重的存在，其实观察 GitHub 的功能模块对项目的支持

先说说项目内最基本的文档 --- **README.md**，一份好的 README.md 应该具备以下特点（其实可以多看看 Github 上著名开源项目）

- 支持运行的环境
- 必要的依赖，以及搭建流程
- 项目的安装指南
- 线上的示例或者最后运行环境
- 相关的文档链接
- 相关人员及讨论组

系统的架构图，可以用来减少共同成本，同时管理架构的变更记录，也是蛮重要的

系统的文档库
- 可编辑，可协作，安全（不要使用明文传输的有道云笔记）
- 记录里程碑和架构决策（标题，日期，决策相关状态，产生影响）


### 代码质量

从流程化和工具两个方面来提升代码质量。
所谓流程化，一般指的是通过常规代码检视（Code Review） 和阻塞式代码审视（PR）

如果对于代码有洁癖，推荐两者结合起来使用，这里稍微解释一下：

所谓常规代码审视，通常指通过 code review，代码说明和注释等方式来保证质量，
而阻塞式代码审视，则会比较“硬核”一点，通过技术手段，让不符合规范的代码无法进行提交，团队合作时可以看看 GitFlow


## Build Flow

随着前端工程化的演变，现在前端项目构建也是一个基本技能，同时也是 Web 应用中必不可少的一部分。
它的核心用途是，帮助开发者从源代码开发到最后目标应用的投入生产力

对于前端来说，构建系统常常包括：

- 管理依赖
- 优化开发环境
- 代码质量检查
- 编译和打包（编译器处理，依赖引入，输入文件分片等）
- 测试及部署













